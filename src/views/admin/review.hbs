<h1 class="mt-4">Quản lý Đánh giá</h1>
<p>Duyệt, xem và quản lý các bài đánh giá sách từ người dùng.</p>

<div class="card shadow-sm border-0">
    <div class="card-header bg-white fw-bold">
        Danh sách các bài đánh giá gần đây
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Tên sách</th>
                        <th scope="col">Người đánh giá</th>
                        <th scope="col">Xếp hạng</th>
                        <th scope="col">Ngày đăng</th>
                        <th scope="col">Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each reviews}}
                    <tr>
                        <th scope="row">{{@index}}</th>
                        <td>{{this.bookId.title}}</td>
                        <td>{{this.userId.username}}</td>
                        <td><i class="fas fa-star text-warning"></i> {{this.rating}}</td>
                        <td>{{this.createdAt}}</td>
                        <td>
                            <button class="btn btn-sm btn-info text-white me-2 view-review-btn" data-bs-toggle="modal" data-bs-target="#viewReviewModal" data-review-id="{{this._id}}"><i class="fas fa-eye"></i></button>
                            <button class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="viewReviewModal" tabindex="-1" aria-labelledby="viewReviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewReviewModalLabel">Chi Tiết Đánh Giá</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <strong>Tên sách:</strong> <span id="reviewBookTitle"></span>
                </div>
                <div class="mb-3">
                    <strong>Người đánh giá:</strong> <span id="reviewUserName"></span>
                </div>
                <div class="mb-3">
                    <strong>Xếp hạng:</strong> <span id="reviewRating"></span>
                </div>
                <div class="mb-3">
                    <strong>Nội dung:</strong>
                    <p id="reviewContent" class="mt-2 p-3 bg-light rounded"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-danger"><i class="fas fa-trash me-2"></i>Xóa đánh giá</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('viewReviewModal');
        modal.addEventListener('show.bs.modal', async (event) => {
            const button = event.relatedTarget;
            const reviewId = button.getAttribute('data-review-id');

            try {
                const response = await fetch(`/admin/reviews/${reviewId}`); // Thay đổi URL nếu cần
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const review = await response.json();

                // Cập nhật nội dung modal
                document.getElementById('reviewBookTitle').textContent = review.bookId.title;
                document.getElementById('reviewUserName').textContent = review.userId.username;
                document.getElementById('reviewRating').innerHTML = `<i class="fas fa-star text-warning"></i> ${review.rating}`;
                document.getElementById('reviewContent').textContent = review.content;
            } catch (error) {
                console.error('Error fetching review details:', error);
                // Hiển thị thông báo lỗi trong modal nếu có lỗi
                document.getElementById('reviewBookTitle').textContent = 'Error';
                document.getElementById('reviewUserName').textContent = 'Error';
                document.getElementById('reviewRating').textContent = 'Error';
                document.getElementById('reviewContent').textContent = 'Failed to load review details.';
            }
        });
    });
</script>